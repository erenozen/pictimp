============================= test session starts ==============================
platform linux -- Python 3.14.2, pytest-9.0.2, pluggy-1.6.0 -- /usr/bin/python
cachedir: .pytest_cache
hypothesis profile 'ci' -> database=None, deadline=None, print_blob=True, derandomize=True, suppress_health_check=(HealthCheck.too_slow,)
rootdir: /home/eren/pictimp
configfile: pyproject.toml
plugins: hypothesis-6.151.9, anyio-4.12.1
collecting ... collected 30 items

tests/test_bounds.py::test_lower_bound_empty PASSED                      [  3%]
tests/test_bounds.py::test_lower_bound_single PASSED                     [  6%]
tests/test_bounds.py::test_lower_bound_two_params PASSED                 [ 10%]
tests/test_bounds.py::test_lower_bound_multiple PASSED                   [ 13%]
tests/test_determinism.py::test_determinism_tie_breaking PASSED          [ 16%]
tests/test_determinism.py::test_require_verified_drops_unverified PASSED [ 20%]
tests/test_filesystem.py::test_cache_extraction_fallbacks FAILED         [ 23%]
tests/test_filesystem.py::test_extraction_complete_failure_raises PASSED [ 26%]
tests/test_fuzz.py::test_fuzz_parser_valid_models FAILED                 [ 30%]
tests/test_fuzz.py::test_fuzz_parser_invalid_models PASSED               [ 33%]
tests/test_fuzz.py::test_hard_limits_raise_validation_errors PASSED      [ 36%]
tests/test_integration_sample.py::test_integration_sample PASSED         [ 40%]
tests/test_model.py::test_make_safe_name PASSED                          [ 43%]
tests/test_model.py::test_model_serialization PASSED                     [ 46%]
tests/test_model.py::test_model_parsing PASSED                           [ 50%]
tests/test_model.py::test_get_counts PASSED                              [ 53%]
tests/test_model.py::test_model_reordering PASSED                        [ 56%]
tests/test_output_parse.py::test_parse_tsv PASSED                        [ 60%]
tests/test_output_parse.py::test_parse_tsv_with_canonical_headers PASSED [ 63%]
tests/test_output_parse.py::test_parse_empty PASSED                      [ 66%]
tests/test_pict_select.py::test_vendor_target_windows PASSED             [ 70%]
tests/test_pict_select.py::test_vendor_target_linux PASSED               [ 73%]
tests/test_pict_select.py::test_vendor_target_macos_intel PASSED         [ 76%]
tests/test_pict_select.py::test_vendor_target_macos_arm PASSED           [ 80%]
tests/test_pict_select.py::test_vendor_target_unsupported PASSED         [ 83%]
tests/test_verify.py::test_verify_success PASSED                         [ 86%]
tests/test_verify.py::test_verify_fail PASSED                            [ 90%]
tests/test_wizard_mock.py::test_wizard_gather_parameters PASSED          [ 93%]
tests/test_wizard_mock.py::test_wizard_gather_parameters_invalid_retries PASSED [ 96%]
tests/test_wizard_mock.py::test_wizard_generate_and_present_flow PASSED  [100%]

=================================== FAILURES ===================================
_______________________ test_cache_extraction_fallbacks ________________________

tmp_path = PosixPath('/tmp/pytest-of-eren/pytest-0/test_cache_extraction_fallback0')

    def test_cache_extraction_fallbacks(tmp_path):
        # Mocking os.makedirs to raise OSError for the typical paths,
        # forcing it to fallback to tempdir.
    
        # We will let tmp_path be the fallback it finally reaches successfully
    
        def mock_makedirs(name, exist_ok=False):
            if "pairwise-cli" in name and "tmp" not in name.lower() and "temp" not in name.lower():
                raise OSError("Permission denied mocked")
            # else allow
            os.makedirs(name, exist_ok=exist_ok)
    
        with patch('os.makedirs', side_effect=mock_makedirs):
            # Even with mocked failures, get_extracted_pict_path should find the tempdir
            # fallback and return a valid path instead of raising RuntimeError.
            try:
>               path = get_extracted_pict_path()
                       ^^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_filesystem.py:24: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
pairwise_cli/pict.py:73: in get_extracted_pict_path
    os.makedirs(extract_dir, exist_ok=True)
/usr/lib64/python3.14/unittest/mock.py:1175: in __call__
    return self._mock_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/usr/lib64/python3.14/unittest/mock.py:1179: in _mock_call
    return self._execute_mock_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/usr/lib64/python3.14/unittest/mock.py:1240: in _execute_mock_call
    result = effect(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^
tests/test_filesystem.py:18: in mock_makedirs
    os.makedirs(name, exist_ok=exist_ok)
/usr/lib64/python3.14/unittest/mock.py:1175: in __call__
    return self._mock_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   RecursionError: maximum recursion depth exceeded
!!! Recursion detected (same locals & position)

During handling of the above exception, another exception occurred:

tmp_path = PosixPath('/tmp/pytest-of-eren/pytest-0/test_cache_extraction_fallback0')

    def test_cache_extraction_fallbacks(tmp_path):
        # Mocking os.makedirs to raise OSError for the typical paths,
        # forcing it to fallback to tempdir.
    
        # We will let tmp_path be the fallback it finally reaches successfully
    
        def mock_makedirs(name, exist_ok=False):
            if "pairwise-cli" in name and "tmp" not in name.lower() and "temp" not in name.lower():
                raise OSError("Permission denied mocked")
            # else allow
            os.makedirs(name, exist_ok=exist_ok)
    
        with patch('os.makedirs', side_effect=mock_makedirs):
            # Even with mocked failures, get_extracted_pict_path should find the tempdir
            # fallback and return a valid path instead of raising RuntimeError.
            try:
                path = get_extracted_pict_path()
                assert "pairwise-cli" in path
            except RuntimeError as e:
>               pytest.fail(f"Extraction fallback failed to find temp directory override: {e}")
E               Failed: Extraction fallback failed to find temp directory override: maximum recursion depth exceeded

tests/test_filesystem.py:27: Failed
________________________ test_fuzz_parser_valid_models _________________________
  + Exception Group Traceback (most recent call last):
  |   File "/home/eren/pictimp/tests/test_fuzz.py", line 14, in test_fuzz_parser_valid_models
  |     st.lists(
  |     
  |   File "/home/eren/.local/lib/python3.14/site-packages/hypothesis/core.py", line 2246, in wrapped_test
  |     raise the_error_hypothesis_found
  | ExceptionGroup: Hypothesis found 2 distinct failures. (2 sub-exceptions)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "/home/eren/pictimp/tests/test_fuzz.py", line 37, in test_fuzz_parser_valid_models
    |     assert len(model.parameters) == len(param_data)
    | AssertionError: assert 2 == 3
    |  +  where 2 = len([<pairwise_cli.model.Parameter object at 0x7f41d1bb1130>, <pairwise_cli.model.Parameter object at 0x7f41d1bb1550>])
    |  +    where [<pairwise_cli.model.Parameter object at 0x7f41d1bb1130>, <pairwise_cli.model.Parameter object at 0x7f41d1bb1550>] = <pairwise_cli.model.PairwiseModel object at 0x7f41d1bb10d0>.parameters
    |  +  and   3 = len([('0', ['0', '00']), ('1', ['0', '00']), ('#', ['0', '00'])])
    | Falsifying example: test_fuzz_parser_valid_models(
    |     param_data=[(
    |          '0',
    |          ['0', '00'],  # or any other generated value
    |      ), (
    |          '1',  # or any other generated value
    |          ['0', '00'],  # or any other generated value
    |      ), (
    |          '#',
    |          ['0', '00'],  # or any other generated value
    |      )],
    | )
    | Explanation:
    |     These lines were always and only run by failing examples:
    |         /home/eren/pictimp/pairwise_cli/model.py:74
    | 
    | You can reproduce this example by temporarily adding @reproduce_failure('6.151.9', b'AXicY2w0YGw0YGwyMGBgbDREMJVhTAYAfQQGyg==') as a decorator on your test case
    +---------------- 2 ----------------
    | Traceback (most recent call last):
    |   File "/home/eren/pictimp/tests/test_fuzz.py", line 36, in test_fuzz_parser_valid_models
    |     model = PairwiseModel.from_pict_model(model_str)
    |   File "/home/eren/pictimp/pairwise_cli/model.py", line 91, in from_pict_model
    |     raise ValueError("Model must contain at least 2 parameters.")
    | ValueError: Model must contain at least 2 parameters.
    | Falsifying example: test_fuzz_parser_valid_models(
    |     param_data=[(
    |          '0',  # or any other generated value
    |          ['0', '00'],  # or any other generated value
    |      ), (
    |          '#',
    |          ['0', '00'],  # or any other generated value
    |      )],
    | )
    | Explanation:
    |     These lines were always and only run by failing examples:
    |         /home/eren/pictimp/pairwise_cli/model.py:74
    |         /home/eren/pictimp/pairwise_cli/model.py:91
    | 
    | You can reproduce this example by temporarily adding @reproduce_failure('6.151.9', b'AAGBMAGBMAGCMDAAAYEjAYEwAYIwMAAA') as a decorator on your test case
    +------------------------------------
=========================== short test summary info ============================
FAILED tests/test_filesystem.py::test_cache_extraction_fallbacks - Failed: Extraction fallback failed to find temp directory override: maximum recursion depth exceeded
FAILED tests/test_fuzz.py::test_fuzz_parser_valid_models - ExceptionGroup: Hypothesis found 2 distinct failures. (2 sub-exceptions)
======================== 2 failed, 28 passed in 16.72s =========================
